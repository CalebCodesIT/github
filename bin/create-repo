#!/bin/bash
# Create a private repo on github
# Usage:  ./create-repo <repo-name>
clear

#todo: read into array, and process array (allow multiple repos on cmd line)
REPOS=$1

if [ -z "$REPOS" ]
then
    #printf "\n\$REPO is not set"
    #create repos from a file
	REPOS=`cat ../repos-todo`

    # create repos from a list
	#REPOS="aws-ec2 aws-lambda aws-lightsail aws-s3"
	#REPOS="test_delete"
	#REPOS="apache-httpd"
	#REPOS="zapier rss semantic-web"
else
    printf "\$REPOS is set"
fi

printf "\n\$REPOS=[$REPOS]\n"
#read -p "Press <Enter> to continue..."

# --
USER=CalebCodesIT
TOKEN=`cat ../token`
#printf "\nTOKEN=[$token]"

#printf "\$OSTYPE=[$OSTYPE]"

# win
if [[ "$OSTYPE" == "cygwin" ]]; then
	HOME=/g/dev/calebcodesit
	KEY=$HOME/.ssh/id_rsa
#lin
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
	KEY=$HOME/.ssh/id_ed25519_no_pass_github
fi
REPO_DIR=$HOME/repos

./git-config

for repo in $REPOS; do
	printf "\n---\nProcessing: $repo\n"
	mkdir $REPO_DIR/$repo
	pushd .
	cd $REPO_DIR/$repo
	pwd

	git init
	echo "# repo:$repo" >> README.md
    mkdir bin docs support todo
    touch bin/README.md docs/README.md support/README.md todo/README.md
    #mkdir docker buildah deploy data config install src/main/java/calebcodes 
	git add ./README.md ./bin/README.md ./docs/README.md ./support/README.md ./todo/README.md
	git commit -m "initial commit of new repo template"

	# old
	#curl https://api.github.com/user/repos?access_token=$TOKEN -d '{"name":"'$repo'", "private":"true"}'
	#curl https://api.github.com/user/repos?access_token=$TOKEN -d '{"name":"'$repo'"}'

	# new
	#curl -H 'Authorization: token '$TOKEN https://api.github.com/user/repos -d '{"name":"'$repo'"}'
	curl -H 'Authorization: token '$TOKEN https://api.github.com/user/repos -d '{"name":"'$repo'", "private":"true"}'

    ssh-agent bash -c 'ssh-add '$KEY'; git remote add origin git@github.com:'$USER'/'$repo'.git'
	ssh-agent bash -c 'ssh-add '$KEY'; git push -u origin master'
    popd
done
